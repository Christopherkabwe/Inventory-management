{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../generated/prisma/client'\n\nconst connectionString = `${process.env.DATABASE_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,sJAAY,CAAC;IAAE;AAAQ"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/app/api/products/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport async function GET(request) {\r\n    const { searchParams } = new URL(request.url);\r\n    const userId = searchParams.get('userId');\r\n    const search = searchParams.get('search');\r\n\r\n    try {\r\n        const products = await prisma.productList.findMany({\r\n            where: userId ? { createdBy: userId } : {}, // Filter by userId if provided\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                sku: true,\r\n                price: true,\r\n                category: true,\r\n                weightValue: true,\r\n                weightUnit: true,\r\n                packSize: true,\r\n                inventories: {\r\n                    select: {\r\n                        quantity: true,\r\n                        location: true,\r\n                    },\r\n                },\r\n            },\r\n            orderBy: { createdAt: 'desc' },\r\n        });\r\n\r\n        // Aggregate inventory quantity per product\r\n        const productsWithTotalQuantity = products.map(product => ({\r\n            ...product,\r\n            quantity: product.inventories.reduce((sum, inv) => sum + inv.quantity, 0),\r\n        }));\r\n\r\n        return NextResponse.json({ products: productsWithTotalQuantity ?? [] });\r\n    } catch (error) {\r\n        console.error(\"Product fetch error:\", error);\r\n        return NextResponse.json({ error: 'Failed to fetch products' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request) {\r\n    try {\r\n        const {\r\n            name,\r\n            sku,\r\n            price,\r\n            packSize,\r\n            weightValue,\r\n            weightUnit,\r\n            userId,\r\n            location,\r\n            quantity = 0,\r\n        } = await request.json();\r\n\r\n        // Basic validation\r\n        if (!name || !sku || price <= 0 || !userId || !location || !packSize || !weightValue || !weightUnit || quantity <= 0) {\r\n            return NextResponse.json(\r\n                { error: 'Missing or invalid fields: name, sku, price, user, location, or quantity.' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Check for unique SKU\r\n        const existingProduct = await prisma.productList.findUnique({ where: { sku } });\r\n        if (existingProduct) {\r\n            return NextResponse.json({ error: 'SKU already exists.' }, { status: 409 });\r\n        }\r\n\r\n        // Create product and inventory in a transaction\r\n        const product = await prisma.$transaction(async (tx) => {\r\n            const newProduct = await tx.productList.create({\r\n                data: {\r\n                    name,\r\n                    sku,\r\n                    price,\r\n                    packSize,\r\n                    weightValue,\r\n                    weightUnit,\r\n                    createdBy: userId,\r\n                },\r\n            });\r\n\r\n            await tx.inventory.create({\r\n                data: {\r\n                    productId: newProduct.id,\r\n                    productName: newProduct.name,\r\n                    location,\r\n                    quantity,\r\n                    lowStockAt: 5, // Adjust as needed\r\n                    createdBy: userId,\r\n                },\r\n            });\r\n\r\n            return newProduct;\r\n        });\r\n\r\n        // Fetch the product with inventory data\r\n        const productWithQuantity = await prisma.productList.findUnique({\r\n            where: { id: product.id },\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                sku: true,\r\n                price: true,\r\n                packSize: true,\r\n                weightValue: true,\r\n                weightUnit: true,\r\n                inventories: {\r\n                    select: { quantity: true, location: true },\r\n                },\r\n            },\r\n        });\r\n\r\n        const totalQuantity = productWithQuantity.inventories.reduce(\r\n            (sum, inv) => sum + inv.quantity,\r\n            0\r\n        );\r\n        return NextResponse.json(\r\n            { ...productWithQuantity, quantity: totalQuantity },\r\n            { status: 201 }\r\n        );\r\n    } catch (error) {\r\n        console.error(error);\r\n        return NextResponse.json({ error: 'Failed to create product' }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":"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"}}]
}