{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../generated/prisma/client'\n\nconst connectionString = `${process.env.DATABASE_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,8MAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,2LAAY,CAAC;IAAE;AAAQ"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/stockReport.ts"],"sourcesContent":["import { prisma } from './prisma';\r\n\r\nexport async function getStockReport({ startDate, endDate }: { startDate?: Date; endDate?: Date }) {\r\n    const stockMovements = await prisma.stockMovement.findMany({\r\n        where: {\r\n            createdAt: {\r\n                gte: startDate,\r\n                lte: endDate,\r\n            },\r\n        },\r\n        include: {\r\n            inventory: {\r\n                include: { product: true, location: true },\r\n            },\r\n            sale: true,\r\n            customer: true,\r\n            fromLocation: true,\r\n            toLocation: true,\r\n        },\r\n        orderBy: { createdAt: 'asc' },\r\n    });\r\n\r\n    const report: Record<string, any> = {};\r\n\r\n    for (const move of stockMovements) {\r\n        const key = `${move.inventory.product.id}-${move.inventory.location.id}`;\r\n        if (!report[key]) {\r\n            report[key] = {\r\n                productId: move.inventory.product.id,\r\n                productName: move.inventory.product.name,\r\n                locationId: move.inventory.location.id,\r\n                locationName: move.inventory.location.name,\r\n                openingStock: 0,\r\n                receipts: 0,\r\n                sales: 0,\r\n                transfersIn: 0,\r\n                transfersOut: 0,\r\n                returns: 0,\r\n                damaged: 0,\r\n                expired: 0,\r\n                rebagGain: 0,\r\n                rebagLoss: 0,\r\n                closingStock: 0,\r\n            };\r\n        }\r\n\r\n        const r = report[key];\r\n\r\n        // Set openingStock from first movement if null\r\n        if (!r.openingStock && move.openingStock !== null) r.openingStock = move.openingStock;\r\n\r\n        switch (move.type) {\r\n            case 'RECEIPT': r.receipts += move.quantity; break;\r\n            case 'SALE': r.sales += move.quantity; break;\r\n            case 'TRANSFER_IN': r.transfersIn += move.quantity; break;\r\n            case 'TRANSFER_OUT': r.transfersOut += move.quantity; break;\r\n            case 'RETURN': r.returns += move.quantity; break;\r\n            case 'DAMAGED': r.damaged += move.quantity; break;\r\n            case 'EXPIRED': r.expired += move.quantity; break;\r\n            case 'REBAG_GAIN': r.rebagGain += move.quantity; break;\r\n            case 'REBAG_LOSS': r.rebagLoss += move.quantity; break;\r\n        }\r\n\r\n        // Last movement closingStock\r\n        if (move.closingStock !== null) r.closingStock = move.closingStock;\r\n    }\r\n\r\n    return Object.values(report);\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEO,eAAe,eAAe,EAAE,SAAS,EAAE,OAAO,EAAwC;IAC7F,MAAM,iBAAiB,MAAM,qKAAM,CAAC,aAAa,CAAC,QAAQ,CAAC;QACvD,OAAO;YACH,WAAW;gBACP,KAAK;gBACL,KAAK;YACT;QACJ;QACA,SAAS;YACL,WAAW;gBACP,SAAS;oBAAE,SAAS;oBAAM,UAAU;gBAAK;YAC7C;YACA,MAAM;YACN,UAAU;YACV,cAAc;YACd,YAAY;QAChB;QACA,SAAS;YAAE,WAAW;QAAM;IAChC;IAEA,MAAM,SAA8B,CAAC;IAErC,KAAK,MAAM,QAAQ,eAAgB;QAC/B,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,SAAS,CAAC,QAAQ,CAAC,EAAE,EAAE;QACxE,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;YACd,MAAM,CAAC,IAAI,GAAG;gBACV,WAAW,KAAK,SAAS,CAAC,OAAO,CAAC,EAAE;gBACpC,aAAa,KAAK,SAAS,CAAC,OAAO,CAAC,IAAI;gBACxC,YAAY,KAAK,SAAS,CAAC,QAAQ,CAAC,EAAE;gBACtC,cAAc,KAAK,SAAS,CAAC,QAAQ,CAAC,IAAI;gBAC1C,cAAc;gBACd,UAAU;gBACV,OAAO;gBACP,aAAa;gBACb,cAAc;gBACd,SAAS;gBACT,SAAS;gBACT,SAAS;gBACT,WAAW;gBACX,WAAW;gBACX,cAAc;YAClB;QACJ;QAEA,MAAM,IAAI,MAAM,CAAC,IAAI;QAErB,+CAA+C;QAC/C,IAAI,CAAC,EAAE,YAAY,IAAI,KAAK,YAAY,KAAK,MAAM,EAAE,YAAY,GAAG,KAAK,YAAY;QAErF,OAAQ,KAAK,IAAI;YACb,KAAK;gBAAW,EAAE,QAAQ,IAAI,KAAK,QAAQ;gBAAE;YAC7C,KAAK;gBAAQ,EAAE,KAAK,IAAI,KAAK,QAAQ;gBAAE;YACvC,KAAK;gBAAe,EAAE,WAAW,IAAI,KAAK,QAAQ;gBAAE;YACpD,KAAK;gBAAgB,EAAE,YAAY,IAAI,KAAK,QAAQ;gBAAE;YACtD,KAAK;gBAAU,EAAE,OAAO,IAAI,KAAK,QAAQ;gBAAE;YAC3C,KAAK;gBAAW,EAAE,OAAO,IAAI,KAAK,QAAQ;gBAAE;YAC5C,KAAK;gBAAW,EAAE,OAAO,IAAI,KAAK,QAAQ;gBAAE;YAC5C,KAAK;gBAAc,EAAE,SAAS,IAAI,KAAK,QAAQ;gBAAE;YACjD,KAAK;gBAAc,EAAE,SAAS,IAAI,KAAK,QAAQ;gBAAE;QACrD;QAEA,6BAA6B;QAC7B,IAAI,KAAK,YAAY,KAAK,MAAM,EAAE,YAAY,GAAG,KAAK,YAAY;IACtE;IAEA,OAAO,OAAO,MAAM,CAAC;AACzB"}},
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/app/api/stock-report/route.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getStockReport } from '@/lib/stockReport';\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n    const { startDate, endDate } = req.query;\r\n\r\n    try {\r\n        const report = await getStockReport({\r\n            startDate: startDate ? new Date(startDate as string) : undefined,\r\n            endDate: endDate ? new Date(endDate as string) : undefined,\r\n        });\r\n        res.status(200).json(report);\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({ error: 'Failed to fetch stock report' });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;;;;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC3E,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAI,KAAK;IAExC,IAAI;QACA,MAAM,SAAS,MAAM,IAAA,kLAAc,EAAC;YAChC,WAAW,YAAY,IAAI,KAAK,aAAuB;YACvD,SAAS,UAAU,IAAI,KAAK,WAAqB;QACrD;QACA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACzB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA+B;IACjE;AACJ"}}]
}