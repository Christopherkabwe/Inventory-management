{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../generated/prisma/client'\n\nconst connectionString = `${process.env.DATABASE_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,8MAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,2LAAY,CAAC;IAAE;AAAQ"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/app/api/stock-transfer/route.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma';\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { productId, fromLocationId, toLocationId, quantity, createdBy, reason } = await req.json();\r\n\r\n        if (!productId || !fromLocationId || !toLocationId || quantity <= 0) {\r\n            return NextResponse.json({ error: 'Invalid transfer data' }, { status: 400 });\r\n        }\r\n\r\n        if (fromLocationId === toLocationId) {\r\n            return NextResponse.json({ error: 'Cannot transfer to the same location' }, { status: 400 });\r\n        }\r\n\r\n        const result = await prisma.$transaction(async (tx) => {\r\n            // ✅ Get source inventory\r\n            const fromInventory = await tx.inventory.findUnique({\r\n                where: { productId_locationId: { productId, locationId: fromLocationId } },\r\n            });\r\n            if (!fromInventory || fromInventory.quantity < quantity) {\r\n                throw new Error('Insufficient stock at source location');\r\n            }\r\n\r\n            // ✅ Get or create destination inventory\r\n            let toInventory = await tx.inventory.findUnique({\r\n                where: { productId_locationId: { productId, locationId: toLocationId } },\r\n            });\r\n            if (!toInventory) {\r\n                toInventory = await tx.inventory.create({\r\n                    data: {\r\n                        productId,\r\n                        locationId: toLocationId,\r\n                        quantity: 0,\r\n                        lowStockAt: 0,\r\n                        createdBy: createdBy || 'system',\r\n                    },\r\n                });\r\n            }\r\n\r\n            // ✅ Update quantities\r\n            const updatedFromInventory = await tx.inventory.update({\r\n                where: { id: fromInventory.id },\r\n                data: { quantity: { decrement: quantity } },\r\n            });\r\n\r\n            const updatedToInventory = await tx.inventory.update({\r\n                where: { id: toInventory.id },\r\n                data: { quantity: { increment: quantity } },\r\n            });\r\n\r\n            // ✅ Log stock movements\r\n            await tx.stockMovement.createMany({\r\n                data: [\r\n                    {\r\n                        inventoryId: fromInventory.id,\r\n                        type: 'TRANSFER_OUT',\r\n                        quantity,\r\n                        openingStock: fromInventory.quantity,\r\n                        closingStock: updatedFromInventory.quantity,\r\n                        fromLocationId,\r\n                        toLocationId,\r\n                        reason: reason || null,\r\n                        createdBy: createdBy || 'system',\r\n                    },\r\n                    {\r\n                        inventoryId: toInventory.id,\r\n                        type: 'TRANSFER_IN',\r\n                        quantity,\r\n                        openingStock: toInventory.quantity,\r\n                        closingStock: updatedToInventory.quantity,\r\n                        fromLocationId,\r\n                        toLocationId,\r\n                        reason: reason || null,\r\n                        createdBy: createdBy || 'system',\r\n                    },\r\n                ],\r\n            });\r\n\r\n            return { success: true };\r\n        });\r\n\r\n        return NextResponse.json(result);\r\n    } catch (error: any) {\r\n        console.error(error);\r\n        return NextResponse.json({ error: error.message || 'Stock transfer failed' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,SAAS,EAAE,cAAc,EAAE,YAAY,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAE/F,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,gBAAgB,YAAY,GAAG;YACjE,OAAO,qLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,IAAI,mBAAmB,cAAc;YACjC,OAAO,qLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC9F;QAEA,MAAM,SAAS,MAAM,qKAAM,CAAC,YAAY,CAAC,OAAO;YAC5C,yBAAyB;YACzB,MAAM,gBAAgB,MAAM,GAAG,SAAS,CAAC,UAAU,CAAC;gBAChD,OAAO;oBAAE,sBAAsB;wBAAE;wBAAW,YAAY;oBAAe;gBAAE;YAC7E;YACA,IAAI,CAAC,iBAAiB,cAAc,QAAQ,GAAG,UAAU;gBACrD,MAAM,IAAI,MAAM;YACpB;YAEA,wCAAwC;YACxC,IAAI,cAAc,MAAM,GAAG,SAAS,CAAC,UAAU,CAAC;gBAC5C,OAAO;oBAAE,sBAAsB;wBAAE;wBAAW,YAAY;oBAAa;gBAAE;YAC3E;YACA,IAAI,CAAC,aAAa;gBACd,cAAc,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;oBACpC,MAAM;wBACF;wBACA,YAAY;wBACZ,UAAU;wBACV,YAAY;wBACZ,WAAW,aAAa;oBAC5B;gBACJ;YACJ;YAEA,sBAAsB;YACtB,MAAM,uBAAuB,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;gBACnD,OAAO;oBAAE,IAAI,cAAc,EAAE;gBAAC;gBAC9B,MAAM;oBAAE,UAAU;wBAAE,WAAW;oBAAS;gBAAE;YAC9C;YAEA,MAAM,qBAAqB,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;gBACjD,OAAO;oBAAE,IAAI,YAAY,EAAE;gBAAC;gBAC5B,MAAM;oBAAE,UAAU;wBAAE,WAAW;oBAAS;gBAAE;YAC9C;YAEA,wBAAwB;YACxB,MAAM,GAAG,aAAa,CAAC,UAAU,CAAC;gBAC9B,MAAM;oBACF;wBACI,aAAa,cAAc,EAAE;wBAC7B,MAAM;wBACN;wBACA,cAAc,cAAc,QAAQ;wBACpC,cAAc,qBAAqB,QAAQ;wBAC3C;wBACA;wBACA,QAAQ,UAAU;wBAClB,WAAW,aAAa;oBAC5B;oBACA;wBACI,aAAa,YAAY,EAAE;wBAC3B,MAAM;wBACN;wBACA,cAAc,YAAY,QAAQ;wBAClC,cAAc,mBAAmB,QAAQ;wBACzC;wBACA;wBACA,QAAQ,UAAU;wBAClB,WAAW,aAAa;oBAC5B;iBACH;YACL;YAEA,OAAO;gBAAE,SAAS;YAAK;QAC3B;QAEA,OAAO,qLAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC;QACd,OAAO,qLAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAChG;AACJ"}}]
}