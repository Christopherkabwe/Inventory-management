{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/stack/server.tsx"],"sourcesContent":["import \"server-only\";\n\nimport { StackServerApp } from \"@stackframe/stack\";\nimport { stackClientApp } from \"./client\";\n\nexport const stackServerApp = new StackServerApp({\n  inheritsFrom: stackClientApp,\n});\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;;;;AAEO,MAAM,iBAAiB,IAAI,yQAAc,CAAC;IAC/C,cAAc,8KAAc;AAC9B"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/auth.ts"],"sourcesContent":["import { stackServerApp } from \"@/stack/server\";\nimport { redirect } from \"next/navigation\";\n\n\nexport async function getCurrentUser() {\n    const user = await stackServerApp.getUser()\n    if (!user) {\n        redirect(\"/sign-in\");\n    }\n\n    return user;\n}"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAGO,eAAe;IAClB,MAAM,OAAO,MAAM,8KAAc,CAAC,OAAO;IACzC,IAAI,CAAC,MAAM;QACP,IAAA,sOAAQ,EAAC;IACb;IAEA,OAAO;AACX"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../generated/prisma/client'\n\nconst connectionString = `${process.env.DATABASE_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,4MAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,yLAAY,CAAC;IAAE;AAAQ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/actions/products.ts"],"sourcesContent":["\"use server\"\n\nimport { getCurrentUser } from \"../auth\";\nimport { prisma } from \"../prisma\";\nimport { z } from \"zod\";\nimport { revalidatePath } from \"next/cache\";\n\nconst ProductSchema = z.object({\n    name: z.string().min(3, \"Name is required\"),\n    sku: z.string().min(1, \"SKU is required\"),\n    price: z.coerce.number().positive(\"Enter a valid price\"),\n    packSize: z.coerce.number().int().positive(\"Enter a valid pack size\"),\n    weightValue: z.coerce.number().positive(\"Enter a valid weight\"),\n    weightUnit: z.string().min(1, \"Weight unit is required (e.g., kg, lbs)\"),\n    location: z.string().min(1, \"Location is required\"),\n    quantity: z.coerce.number().int().min(0, \"Quantity is required\"),\n    lowStockAt: z.coerce.number().int().min(0).optional(),\n});\n\n\nexport async function deleteFromInventory(\n    _prevState: { success: boolean; message: string | null } | null,\n    formData: FormData\n) {\n    const user = await getCurrentUser();\n    if (!user) return { success: false, message: \"Unauthorized\" };\n\n    const id = String(formData.get(\"id\") || \"\");\n    if (!id) return { success: false, message: \"Inventory ID is required\" };\n\n    try {\n        const inventory = await prisma.inventory.findUnique({\n            where: { id, createdBy: user.id },\n            include: { product: true },\n        });\n\n        if (!inventory) {\n            return { success: false, message: \"Inventory not found or unauthorized.\" };\n        }\n\n        await prisma.$transaction([\n            prisma.inventory.delete({ where: { id, createdBy: user.id } }),\n            // Optional: Delete the product if you want to remove it entirely\n            // prisma.productList.delete({\n            //   where: { id: inventory.productId, createdBy: user.id },\n            // }),\n        ]);\n\n        revalidatePath(\"/inventory\");\n        return { success: true, message: `Inventory for \"${inventory.product.name}\" has been deleted!` };\n    } catch (error) {\n        console.error(\"Failed to delete inventory:\", error);\n        return { success: false, message: \"Failed to delete inventory. Try again later.\" };\n    }\n}\n\nexport async function editInventory(prevState: any, formData: FormData) {\n    const id = formData.get(\"id\") as string;\n    const price = Number(formData.get(\"price\"));\n    const quantity = Number(formData.get(\"quantity\"));\n    const lowStockAt = Number(formData.get(\"lowStockAt\"));\n    const locationId = formData.get(\"locationId\") as string;\n\n    try {\n        const inventory = await prisma.inventory.findUnique({\n            where: { id },\n            include: { product: true },\n        });\n        if (!inventory) {\n            return { message: \"Inventory not found.\", success: false };\n        }\n\n        await prisma.$transaction([\n            prisma.productList.update({\n                where: { id: inventory.productId },\n                data: { price },\n            }),\n            prisma.inventory.update({\n                where: { id },\n                data: { quantity, lowStockAt, locationId },\n            }),\n        ]);\n\n        revalidatePath(\"/inventory\");\n        return { message: `Inventory updated for ${inventory.product.name}!`, success: true };\n    } catch (e) {\n        console.error(e);\n        return { message: \"Failed to update inventory.\", success: false };\n    }\n}\n\n//export async function CreateProduct(formData: FormData) {\n\nexport async function CreateProduct(\n    _prevState: { success: boolean; message: string | null; errors?: Record<string, string[]> } | null,\n    formData: FormData\n) {\n    const user = await getCurrentUser();\n    const parsed = ProductSchema.safeParse({\n        name: formData.get(\"name\"),\n        sku: formData.get(\"sku\"),\n        price: formData.get(\"price\"),\n        packSize: formData.get(\"packSize\"),\n        weightValue: formData.get(\"weightValue\"),\n        weightUnit: formData.get(\"weightUnit\"),\n        location: formData.get(\"location\"), // Update this line\n        quantity: formData.get(\"quantity\"),\n        lowStockAt: formData.get(\"lowStockAt\") || undefined,\n    });\n\n    if (!parsed.success) {\n        return { success: false, message: \"Validation failed\", errors: parsed.error.flatten().fieldErrors };\n    }\n\n    try {\n        // Check if product with same SKU exists\n        const existingProduct = await prisma.productList.findUnique({\n            where: { sku: parsed.data.sku },\n        });\n\n        let product;\n        if (existingProduct) {\n            product = existingProduct;\n        } else {\n            // Create product if it doesn't exist\n            product = await prisma.productList.create({\n                data: {\n                    name: parsed.data.name,\n                    sku: parsed.data.sku,\n                    price: parsed.data.price,\n                    packSize: parsed.data.packSize,\n                    weightValue: parsed.data.weightValue,\n                    weightUnit: parsed.data.weightUnit,\n                    createdBy: user.id,\n                },\n            });\n        }\n\n        const location = await prisma.location.findUnique({\n            where: { name: parsed.data.location },\n        });\n\n        if (!location) {\n            return { success: false, message: \"Location not found.\" };\n        }\n\n        // Add to inventory\n        await prisma.inventory.create({\n            data: {\n                product: {\n                    connect: {\n                        id: product.id,\n                    },\n                },\n                location: {\n                    connect: {\n                        id: location.id,\n                    },\n                },\n                quantity: parsed.data.quantity,\n                lowStockAt: parsed.data.lowStockAt || 5,\n                createdBy: user.id,\n            },\n        });\n\n        return { success: true, message: \"Product added to inventory!\" };\n    } catch (error) {\n        console.error(\"Failed to create product:\", error);\n        return { success: false, message: \"Failed to add product.\" };\n    }\n}\n\nexport async function getProducts() {\n    const user = await getCurrentUser();\n    if (!user) return [];\n\n    const products = await prisma.inventory.findMany({\n        where: {\n            createdBy: user.id,\n        },\n        include: {\n            product: true,\n            location: true,\n        },\n        orderBy: {\n            createdAt: \"desc\",\n        },\n        take: 50, // limit list (important for performance)\n    });\n\n    return products;\n}\n\n"],"names":[],"mappings":"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"}}]
}