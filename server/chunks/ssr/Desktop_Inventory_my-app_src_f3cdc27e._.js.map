{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/app/reports/page.tsx"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\r\n\r\ntype StockReportRow = {\r\n    productName: string;\r\n    location: string;\r\n    openingStock: number;\r\n    production: number;\r\n    ibtReceived: number;\r\n    ibtIssued: number;\r\n    rebagGain: number;\r\n    damaged: number;\r\n    expired: number;\r\n    returns: number;\r\n    salesQty: number;\r\n    closingStock: number;\r\n};\r\n\r\nexport async function getStockReport(): Promise<StockReportRow[]> {\r\n    // Fetch all inventories with related product and location\r\n    const inventories = await prisma.inventory.findMany({\r\n        include: {\r\n            product: {\r\n                include: {\r\n                    productions: true,\r\n                    adjustments: true,\r\n                    transfers: true,\r\n                },\r\n            },\r\n            location: true,\r\n        },\r\n    });\r\n\r\n    const report: StockReportRow[] = [];\r\n\r\n    for (const inv of inventories) {\r\n        const { product, location } = inv;\r\n\r\n        // Fetch sales for this product at this location\r\n        const sales = await prisma.sale.findMany({\r\n            where: {\r\n                productId: product.id,\r\n                locationId: location.id,\r\n            },\r\n        });\r\n\r\n        const salesQty = sales.filter(s => !s.isReturn).reduce((acc, s) => acc + s.quantity, 0);\r\n        const returnsQty = sales.filter(s => s.isReturn).reduce((acc, s) => acc + s.quantity, 0);\r\n\r\n        const ibtIssued = product.transfers\r\n            .filter(t => t.fromLocationId === location.id)\r\n            .reduce((acc, t) => acc + t.quantity, 0);\r\n\r\n        const ibtReceived = product.transfers\r\n            .filter(t => t.toLocationId === location.id)\r\n            .reduce((acc, t) => acc + t.quantity, 0);\r\n\r\n        const production = product.productions.reduce((acc, p) => acc + p.quantity, 0);\r\n\r\n        const rebagGain = product.adjustments\r\n            .filter(a => a.locationId === location.id && a.type === \"REBAG_GAIN\")\r\n            .reduce((acc, a) => acc + a.quantity, 0);\r\n\r\n        const damaged = product.adjustments\r\n            .filter(a => a.locationId === location.id && a.type === \"DAMAGED\")\r\n            .reduce((acc, a) => acc + a.quantity, 0);\r\n\r\n        const expired = product.adjustments\r\n            .filter(a => a.locationId === location.id && a.type === \"EXPIRED\")\r\n            .reduce((acc, a) => acc + a.quantity, 0);\r\n\r\n        const openingStock = inv.quantity;\r\n\r\n        const closingStock =\r\n            openingStock +\r\n            production +\r\n            ibtReceived +\r\n            rebagGain +\r\n            returnsQty -\r\n            ibtIssued -\r\n            salesQty -\r\n            damaged -\r\n            expired;\r\n\r\n        report.push({\r\n            productName: product.name,\r\n            location: location.name,\r\n            openingStock,\r\n            production,\r\n            ibtReceived,\r\n            ibtIssued,\r\n            rebagGain,\r\n            damaged,\r\n            expired,\r\n            returns: returnsQty,\r\n            salesQty,\r\n            closingStock,\r\n        });\r\n    }\r\n\r\n    return report;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAiBO,eAAe;IAClB,0DAA0D;IAC1D,MAAM,cAAc,MAAM,mKAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;QAChD,SAAS;YACL,SAAS;gBACL,SAAS;oBACL,aAAa;oBACb,aAAa;oBACb,WAAW;gBACf;YACJ;YACA,UAAU;QACd;IACJ;IAEA,MAAM,SAA2B,EAAE;IAEnC,KAAK,MAAM,OAAO,YAAa;QAC3B,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG;QAE9B,gDAAgD;QAChD,MAAM,QAAQ,MAAM,mKAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACrC,OAAO;gBACH,WAAW,QAAQ,EAAE;gBACrB,YAAY,SAAS,EAAE;YAC3B;QACJ;QAEA,MAAM,WAAW,MAAM,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QACrF,MAAM,aAAa,MAAM,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAEtF,MAAM,YAAY,QAAQ,SAAS,CAC9B,MAAM,CAAC,CAAA,IAAK,EAAE,cAAc,KAAK,SAAS,EAAE,EAC5C,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE1C,MAAM,cAAc,QAAQ,SAAS,CAChC,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,KAAK,SAAS,EAAE,EAC1C,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE1C,MAAM,aAAa,QAAQ,WAAW,CAAC,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE5E,MAAM,YAAY,QAAQ,WAAW,CAChC,MAAM,CAAC,CAAA,IAAK,EAAE,UAAU,KAAK,SAAS,EAAE,IAAI,EAAE,IAAI,KAAK,cACvD,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE1C,MAAM,UAAU,QAAQ,WAAW,CAC9B,MAAM,CAAC,CAAA,IAAK,EAAE,UAAU,KAAK,SAAS,EAAE,IAAI,EAAE,IAAI,KAAK,WACvD,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE1C,MAAM,UAAU,QAAQ,WAAW,CAC9B,MAAM,CAAC,CAAA,IAAK,EAAE,UAAU,KAAK,SAAS,EAAE,IAAI,EAAE,IAAI,KAAK,WACvD,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAE1C,MAAM,eAAe,IAAI,QAAQ;QAEjC,MAAM,eACF,eACA,aACA,cACA,YACA,aACA,YACA,WACA,UACA;QAEJ,OAAO,IAAI,CAAC;YACR,aAAa,QAAQ,IAAI;YACzB,UAAU,SAAS,IAAI;YACvB;YACA;YACA;YACA;YACA;YACA;YACA;YACA,SAAS;YACT;YACA;QACJ;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/CHRISTOPHER%20KABWE/Desktop/Inventory/my-app/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../generated/prisma/client'\n\nconst connectionString = `${process.env.DATABASE_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma };"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,4MAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,yLAAY,CAAC;IAAE;AAAQ"}}]
}